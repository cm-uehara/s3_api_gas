<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial, sans-serif; }
      .form-group { margin-bottom: 10px; }
      label { display: block; margin-bottom: 5px; }
      textarea { width: 100%; padding: 5px; box-sizing: border-box; height: 150px; }
      .button-container { text-align: right; margin-top: 15px; }
      button { padding: 5px 10px; margin-left: 10px; }
    </style>
  </head>
  <body>
    <div class="form-group">
      <label for="awsSecrets">AWS 認証情報 (AccessKeyId:SecretAccessKey:SessionToken):</label>
      <textarea id="awsSecrets" required></textarea>
    </div>
    <div class="button-container">
      <button onclick="readFile()">ファイルを読み込む</button>
      <button onclick="writeFile()">ファイルを書き込む</button>
    </div>

    <script>
      function getCredentials() {
        var awsSecrets = document.getElementById('awsSecrets').value.trim();
        
        if (!awsSecrets) {
          alert('AWS Secretsを入力してください。');
          return null;
        }

        var parts = awsSecrets.split(':');
        if (parts.length !== 3) {
          alert('AWS Secretsの形式が正しくありません。AccessKeyId:SecretAccessKey:SessionTokenの形式で入力してください。');
          return null;
        }

        return { accessKeyId: parts[0], secretAccessKey: parts[1], sessionToken: parts[2] };
      }

      function readFile() {
        var credentials = getCredentials();
        if (credentials) {
          google.script.run
            .withSuccessHandler(onSuccess)
            .withFailureHandler(onFailure)
            .readTable(credentials.accessKeyId, credentials.secretAccessKey, credentials.sessionToken);
        }
      }

      function writeFile() {
        var credentials = getCredentials();
        if (credentials) {
          google.script.run
            .withSuccessHandler(onSuccess)
            .withFailureHandler(onFailure)
            .writeTable(credentials.accessKeyId, credentials.secretAccessKey, credentials.sessionToken);
        }
      }

      function onSuccess(result) {
        alert('操作が成功しました: ' + result);
        google.script.host.close();
      }

      function onFailure(error) {
        alert('エラーが発生しました: ' + error.message);
      }
    </script>
  </body>
</html>